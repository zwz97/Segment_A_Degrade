# Data Directory

This directory stores input images, annotations, the derived `degradation_map.json` used by pipelines, and utility scripts for data preparation and validation.

## Core Components

* `images/gt_img/`: Contains the original, undegraded images (e.g., `1.jpg`) and their corresponding annotation files in COCO format (e.g., `1_annotations.json`). These are the source files used by `build_local_map.py`.
* `images/img_degraded/`: Contains subdirectories for each degradation type (e.g., `gaussian_blur`, `jpeg_compression`), which in turn contain the degraded image files named according to the degradation applied (e.g., `1_gaussian_blur_5.jpg`). These are referenced by `degradation_map.json`.
* `degradation_map.json`: (Generated by `build_local_map.py`, required for `sam2_eval` pipeline). A crucial JSON index file mapping image IDs to their ground truth mask (in COCO RLE format) and the file paths of all available versions (original and degraded). This map is the primary input for evaluation pipelines. Structure example:

```json
{
  "<image_id>": {
    "ground_truth_rle": { "size": [H, W], "counts": "..." },
    "versions": {
      "original": { "filepath": "images/gt_img/<id>.jpg", ... },
      "gaussian_blur": {
        "5": { "filepath": "images/img_degraded/gaussian_blur/<id>_gaussian_blur_5.jpg", ... },
        ...
      }, ...
    }
  }, ...
}
```

## `data_scripts/`

Contains Python scripts for dataset preparation, validation, and visualization:

* `code_degradation.py`: (Optional initial step) Samples images/annotations from a source dataset (e.g., COCO), downloads them, applies specified degradations, and organizes them into the `images/gt_img/` and `images/img_degraded/` structure.
  * Requires `pycocotools`, `opencv-python`, `scikit-image`.
* `build_local_map.py`: Scans the `images/gt_img/` and `images/img_degraded/` directories to generate the `degradation_map.json` file. It extracts image IDs, finds corresponding annotations, converts ground truth masks to RLE format, locates all degraded versions, and compiles the map. Run this script after generating/placing images and annotations.
  * Requires `pycocotools`, `Pillow`.
  * Usage: `python data/data_scripts/build_local_map.py` (run from project root)
* `data_utils.py`: A command-line utility for interacting with the `degradation_map.json`. Can be used to:
  * Validate the map structure, file existence, and consistency with images on disk (`--action validate`).
  * Count images and degradation versions (`--action count`).
  * Visualize samples interactively (`--action visualize`).
  * Plot samples to files (`--action plot_all`, supports specific `--ids` and `--clean` option).
  * Requires `matplotlib`, `Pillow`, `numpy`, `pycocotools`.
  * Usage: `python data/data_scripts/data_utils.py --action <action_name> [options]` (run from project root)

**Note:** This directory is typically excluded from Git version control (see `.gitignore`) due to potentially large data files. Only the scripts and the README are usually committed.
